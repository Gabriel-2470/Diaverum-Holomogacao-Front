<div class="redefinir-container">
  <div class="redefinir-card">
    <!-- ğŸ”„ Estado: Verificando Token -->
    <div *ngIf="verificandoToken" class="loading-state">
      <span class="spinner"></span>
      <p>Verificando token...</p>
    </div>

    <!-- âŒ Estado: Token InvÃ¡lido -->
    <div *ngIf="!verificandoToken && !tokenValido" class="invalid-token-state">
      <div class="error-icon">âš ï¸</div>
      <h1>Token InvÃ¡lido</h1>
      <p>{{ errorMessage }}</p>
      <button type="button" class="btn-voltar" (click)="voltarLogin()">â† Voltar para Login</button>
    </div>

    <!-- âœ… Estado: Token VÃ¡lido - FormulÃ¡rio -->
    <div *ngIf="!verificandoToken && tokenValido">
      <div class="redefinir-header">
        <h1>Redefinir Senha</h1>
        <p>Escolha uma nova senha segura</p>
      </div>

      <form [formGroup]="redefinirForm" (ngSubmit)="onSubmit()">
        <!-- Campo Nova Senha -->
        <div class="form-group">
          <label for="novaSenha">Nova Senha</label>
          <div class="password-wrapper">
            <input
              [type]="mostrarSenha ? 'text' : 'password'"
              id="novaSenha"
              formControlName="novaSenha"
              placeholder="Digite sua nova senha"
              autocomplete="new-password"
              [class.error]="novaSenha?.invalid && novaSenha?.touched"
            />
            <button
              type="button"
              class="btn-toggle-password"
              (click)="toggleMostrarSenha()"
              [attr.aria-label]="mostrarSenha ? 'Ocultar senha' : 'Mostrar senha'"
            >
              {{ mostrarSenha ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
            </button>
          </div>
          <div class="error-message" *ngIf="novaSenha?.invalid && novaSenha?.touched">
            <span *ngIf="novaSenha?.errors?.['required']">Senha Ã© obrigatÃ³ria</span>
            <span *ngIf="novaSenha?.errors?.['minlength']">
              Senha deve ter no mÃ­nimo 6 caracteres
            </span>
          </div>
        </div>

        <!-- Campo Confirmar Senha -->
        <div class="form-group">
          <label for="confirmarSenha">Confirmar Senha</label>
          <div class="password-wrapper">
            <input
              [type]="mostrarConfirmacao ? 'text' : 'password'"
              id="confirmarSenha"
              formControlName="confirmarSenha"
              placeholder="Digite novamente a senha"
              autocomplete="new-password"
              [class.error]="
                (confirmarSenha?.invalid && confirmarSenha?.touched) ||
                (redefinirForm.errors?.['senhasDiferentes'] && confirmarSenha?.touched)
              "
            />
            <button
              type="button"
              class="btn-toggle-password"
              (click)="toggleMostrarConfirmacao()"
              [attr.aria-label]="mostrarConfirmacao ? 'Ocultar senha' : 'Mostrar senha'"
            >
              {{ mostrarConfirmacao ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
            </button>
          </div>
          <div class="error-message" *ngIf="confirmarSenha?.invalid && confirmarSenha?.touched">
            <span *ngIf="confirmarSenha?.errors?.['required']">
              ConfirmaÃ§Ã£o de senha Ã© obrigatÃ³ria
            </span>
          </div>
          <div
            class="error-message"
            *ngIf="redefinirForm.errors?.['senhasDiferentes'] && confirmarSenha?.touched"
          >
            <span>As senhas nÃ£o coincidem</span>
          </div>
        </div>

        <!-- Mensagem de Erro -->
        <div class="alert-error" *ngIf="errorMessage">
          {{ errorMessage }}
        </div>

        <!-- Mensagem de Sucesso -->
        <div class="alert-success" *ngIf="successMessage">
          {{ successMessage }}
        </div>

        <!-- BotÃ£o Submit -->
        <button type="submit" class="btn-redefinir" [disabled]="isLoading || redefinirForm.invalid">
          <span *ngIf="!isLoading">Redefinir Senha</span>
          <span *ngIf="isLoading">
            <span class="spinner"></span>
            Redefinindo...
          </span>
        </button>

        <!-- Voltar para Login -->
        <div class="redefinir-footer">
          <button type="button" class="btn-voltar" (click)="voltarLogin()">
            â† Voltar para Login
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
