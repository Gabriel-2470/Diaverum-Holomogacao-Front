<div class="container">
  <div class="header">
    <h1>Gerenciamento de Perfis de Exames</h1>
    <button class="btn-primary" (click)="novoPerfil()">Novo Perfil</button>
  </div>

  <!-- Indicador de carregamento -->
  <div class="loading" *ngIf="carregando">
    <p>Carregando perfis...</p>
  </div>

  <!-- Mensagem de erro -->
  <div class="erro" *ngIf="erro && !carregando">
    <p>{{ erro }}</p>
    <button class="btn-secondary" (click)="carregarTudo()">Tentar novamente</button>
  </div>

  <!-- Tabela de perfis -->
  <div *ngIf="!carregando && !erro">
    <div class="table-header">
      <div class="col-perfil">PERFIL DE EXAME</div>
      <div class="col-responsavel">RESPONSÁVEL</div>
      <div class="col-exames">EXAMES</div>
      <div class="col-acoes"></div>
    </div>

    <div class="perfis-lista" *ngIf="perfis.length > 0; else semPerfis">
      <div
        class="perfil-card"
        *ngFor="let perfil of perfis"
        [class.expandido]="isExpandido(perfil.id)"
      >
        <div class="perfil-header" (click)="toggleExames(perfil.id)">
          <div class="col-perfil">
            <span class="perfil-nome">{{ perfil.nome }}</span>
          </div>
          <div class="col-responsavel">
            <span class="responsavel-nome">{{ perfil.responsavel || 'N/A' }}</span>
          </div>
          <div class="col-exames">
            <span class="exames-count"
              >{{ perfil.exames.length }} exame{{ perfil.exames.length !== 1 ? 's' : '' }}</span
            >
          </div>
          <div class="col-acoes">
            <div class="perfil-acoes" (click)="$event.stopPropagation()">
              <button
                class="btn-icon btn-editar"
                (click)="editarPerfil(perfil)"
                title="Editar perfil"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                </svg>
              </button>
              <button
                class="btn-icon btn-excluir"
                (click)="excluirPerfil(perfil)"
                title="Excluir perfil"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path
                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                  ></path>
                </svg>
              </button>
            </div>

            <div class="seta-expandir">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </div>
          </div>
        </div>

        <!-- Lista de exames expandida -->
        <div class="exames-expandido" *ngIf="isExpandido(perfil.id)">
          <div class="exames-table-header">
            <div class="exame-col-codigo">CÓD. MNEMÔNICO</div>
            <div class="exame-col-nome">EXAME</div>
            <div class="exame-col-material">MATERIAL</div>
          </div>
          <div class="exame-row" *ngFor="let exame of perfil.exames">
            <div class="exame-col-codigo">{{ exame.codigo || 'N/A' }}</div>
            <div class="exame-col-nome">{{ exame.nome || 'Sem nome' }}</div>
            <div class="exame-col-material">{{ exame.material || 'N/A' }}</div>
          </div>
          <div class="sem-exames" *ngIf="perfil.exames.length === 0">
            <p>Nenhum exame associado a este perfil</p>
          </div>
        </div>
      </div>
    </div>

    <ng-template #semPerfis>
      <div class="sem-dados">
        <p>Nenhum perfil cadastrado</p>
        <p class="subtitulo">Clique em "Novo Perfil" para começar</p>
      </div>
    </ng-template>
  </div>
</div>
